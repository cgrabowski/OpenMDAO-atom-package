<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <style>
    div {
      text-align: center;
    }

    rect {
      stroke: #fff;
    }
  </style>
</head>

<body>
  <div id="chart"></div>
  <script src="d3.min.js"></script>
  <script>
    window.onload = function() {

      var w = window.innerWidth,
        h = window.innerHeight,
        x = d3.scale.linear().range([0, w]),
        y = d3.scale.linear().range([0, h]),
        color = d3.scale.ordinal().range(["rgb(255,247,236)", "rgb(254,232,200)", "rgb(253,212,158)", "rgb(253,187,132)", "rgb(252,141,89)", "rgb(239,101,72)", "rgb(215,48,31)", "rgb(179,0,0)", "rgb(127,0,0)"]);

      var vis = d3.select("#chart").append("svg:svg")
        .attr("width", w)
        .attr("height", h);

      var partition = d3.layout.partition()
        .children(function(d) {
          // If value is not a plain object, then it is treated as a leaf.
          return d.value.constructor.name === 'Object' ? d3.entries(d.value) : null;
        })
        .value(function(d) {
          return d.value;
        });

      var g = vis.selectAll('g').data(partition(d3.entries(data)[0]))
        .enter().append('svg:g')
        .attr("x", function(d) {
          return x(d.x);
        })
        .attr("y", function(d) {
          return y(d.y);
        })
        .attr("width", function(d) {
          //console.log(x(d.dx));
          return x(d.dx);
        })
        .attr("height", function(d) {
          return y(d.dy);
        });

      var rect = g.append('svg:rect')
        .attr("x", function(d) {
          return x(d.x);
        })
        .attr("y", function(d) {
          return y(d.y);
        })
        .attr("width", function(d) {
          //console.log(x(d.dx));
          return x(d.dx);
        })
        .attr("height", function(d) {
          return y(d.dy);
        })
        .attr("fill", function(d) {
          //console.log(d);
          return color((d.children ? d : d.parent).key);
        });

      var text = g.append('svg:text')
        .attr("x", function(d) {
          return x(d.x + 0.003);
        })
        .attr("y", function(d) {
          return y(d.y + 0.03);
        })
        .attr('font-size', function(d) {
          var wh = window.innerHeight;
          return 32 * wh / (wh + 2.0 * y(d.y));
        })
        .text(function(d) {
          return d.key;
        });

      var allTags = vis.selectAll('g, rect, text');
      allTags.on('click', click);

      //console.log(allTags);

      function click(d) {
        x.domain([d.x, d.x + d.dx]);
        y.domain([d.y, 1]).range([d.y ? 20 : 0, h]);

        allTags.transition()
          .duration(750)
          .attr("x", function(d) {
            return x(d.x);
          })
          .attr("y", function(d) {
            return y(d.y);
          })
          .attr("width", function(d) {
            return x(d.x + d.dx) - x(d.x);
          })
          .attr("height", function(d) {
            return y(d.y + d.dy) - y(d.y);
          })
          //.filter('text')
          .attrTween('font-size', function(d, i, attrValue) {
            var wh = window.innerHeight;
            var newSize = 32 * wh / (wh + 2 * y(d.y));
            return d3.interpolate(attrValue, newSize);
          }).each('end', function(d) {
            //this.setAttribute('font-size', (window.innerHeight - this.getAttribute('y')) / 20);
          });

      }
    }

    var data = {
      'root': {
        "chem_eq": {
          "n2ls": {
            "chem_eq:n2ls:rhs": {
              "relative_name": "rhs",
              "shape": [3],
              "size": 3,
              "val": [0.0, 0.0, 0.0],
              "desc": "Right-hand side of resulting system"
            },
            "chem_eq:n2ls:mu": {
              "val": [0.0, 0.0, 0.0],
              "relative_name": "mu",
              "shape": [3],
              "units": "cal/(g*mol)",
              "desc": "Chemical Potential per Kilogram-mole of species j",
              "size": 3
            },
            "chem_eq:n2ls:ch": {
              "relative_name": "ch",
              "shape": [3, 3],
              "size": 9,
              "val": [
                [0.0, 0.0, 0.0],
                [0.0, 0.0, 0.0],
                [0.0, 0.0, 0.0]
              ],
              "desc": "Left-hand side of resulting system"
            },
            "chem_eq:n2ls:b": {
              "relative_name": "b",
              "shape": [2],
              "size": 2,
              "val": [0.0, 0.0],
              "desc": "assigned kg-atoms of element i per total kg of reactant"
            },
            "chem_eq:n2ls:b0": {
              "relative_name": "b0",
              "shape": [2],
              "size": 2,
              "val": [0.0, 0.0],
              "desc": "assigned kg-atoms of element i per total kg of reactant for the initial prod amounts"
            }
          },
          "ls2pi": {
            "chem_eq:ls2pi:x": {
              "shape": [3],
              "relative_name": "x",
              "state": true,
              "val": [0.0, 0.0, 0.0],
              "size": 3
            }
          },
          "pi2n": {
            "chem_eq:pi2n:dLn": {
              "relative_name": "dLn",
              "shape": [4],
              "size": 4,
              "val": [0.0, 0.0, 0.0, 0.0],
              "desc": "Kilogram-moles of species j per kg mixture last element:             Kilogram-moles of mixture per unit mass"
            }
          },
          "next_n": {
            "chem_eq:next_n:lambdaf": {
              "relative_name": "lambdaf",
              "shape": 1,
              "size": 1,
              "val": 1.0,
              "desc": "adaptive under-relaxation factor"
            },
            "chem_eq:next_n:n": {
              "val": [0.03333333333333333, 0.03333333333333333, 0.03333333333333333, 0.1],
              "state": true,
              "relative_name": "n",
              "shape": [4],
              "desc": "computed value of the next iterate for n",
              "size": 4
            }
          }
        },
        "props": {
          "TP2ls": {
            "props:TP2ls:rhs_T": {
              "relative_name": "rhs_T",
              "shape": [3],
              "size": 3,
              "val": [0.0, 0.0, 0.0],
              "desc": "rhs for the T solve"
            },
            "props:TP2ls:rhs_P": {
              "relative_name": "rhs_P",
              "shape": [3],
              "size": 3,
              "val": [0.0, 0.0, 0.0],
              "desc": "rhs for the P solve"
            },
            "props:TP2ls:lhs_TP": {
              "relative_name": "lhs_TP",
              "shape": [3, 3],
              "size": 9,
              "val": [
                [0.0, 0.0, 0.0],
                [0.0, 0.0, 0.0],
                [0.0, 0.0, 0.0]
              ],
              "desc": "A matrix for the totals linear solve"
            }
          },
          "ls2t": {
            "props:ls2t:x": {
              "shape": [3],
              "relative_name": "x",
              "state": true,
              "val": [0.0, 0.0, 0.0],
              "size": 3
            }
          },
          "ls2p": {
            "props:ls2p:x": {
              "shape": [3],
              "relative_name": "x",
              "state": true,
              "val": [0.0, 0.0, 0.0],
              "size": 3
            }
          },
          "tp2tot": {
            "props:tp2tot:h": {
              "val": 0.0,
              "relative_name": "h",
              "shape": 1,
              "units": "cal/g",
              "desc": "enthalpy",
              "size": 1
            },
            "props:tp2tot:S": {
              "val": 0.0,
              "relative_name": "S",
              "shape": 1,
              "units": "cal/(g*degK)",
              "desc": "entropy",
              "size": 1
            },
            "props:tp2tot:gamma": {
              "relative_name": "gamma",
              "shape": 1,
              "size": 1,
              "val": 0.0,
              "desc": "ratio of specific heats"
            },
            "props:tp2tot:Cp": {
              "val": 0.0,
              "relative_name": "Cp",
              "shape": 1,
              "units": "cal/(g*degK)",
              "desc": "Specific heat at constant pressure",
              "size": 1
            },
            "props:tp2tot:Cv": {
              "val": 0.0,
              "relative_name": "Cv",
              "shape": 1,
              "units": "cal/(g*degK)",
              "desc": "Specific heat at constant volume",
              "size": 1
            },
            "props:tp2tot:rho": {
              "val": 0.0,
              "relative_name": "rho",
              "shape": 1,
              "units": "g/cm**3",
              "desc": "density",
              "size": 1
            }
          }
        },
        "init_prod": {
          "init_prod:init_prod_amounts": {
            "shape": [3],
            "relative_name": "init_prod_amounts",
            "val": [0.022722108611679163, 0.0, 0.0],
            "size": 3
          }
        },
        //"temp": {
        //  "temp:T": {
        //    "units": "degK",
        //    "shape": 1,
        //    "relative_name": "T",
        //    "val": 4000.0,
        //    "size": 1
        //  }
        //},
        "pressure": {
          "pressure:P": {
            "shape": 1,
            "relative_name": "P",
            "val": 1.03421,
            "size": 1
          }
        },
        "stupid_english_units": {
          "stupid_english_units:T_eng": {
            "units": "degR",
            "shape": 1,
            "relative_name": "T_eng",
            "val": 0.0,
            "size": 1
          }
        }
      }
    };
  </script>
</body>

</html>
